<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/public/css/style_test_4.css">
    <title>Document</title>
</head>
<body>
<div id="bg" class="bg_img">
    <div class="top">
        <a href="/test_4">
            <img class="icon_back" src="/public/img/back.png">
        </a>
        <a href="/login">
            <img class="icon_menu" src="/public/img/menu.png">
        </a>
    </div>
    <div id ='Tester' class="tester">
        <div id='Instruction' class="instruction text_instruction">
            Этот тест оценивает ваше внимание. Вам необходимо выбрать в возрастающем порядке числа в красных квадратах и в убывающем порядке числа в чёрных квадратах.
        </div>
        <button id='Start_button' class="start_button" name="start" onclick="start_test()">Начать</button>
        <div id='Timer' class="iteration">0s</div>
        <div id='Final Result' class="result"></div>
        <div id='Scene' class="scene">
            <div class="cell-red" val="1" onclick="cell(1)">1</div>
            <div class="cell-red" val="2" onclick="cell(2)">2</div>
            <div class="cell-red" val="3" onclick="cell(3)">3</div>
            <div class="cell-red" val="4" onclick="cell(4)">4</div>
            <div class="cell-red" val="5" onclick="cell(5)">5</div>
            <div class="cell-red" val="6" onclick="cell(6)">6</div>
            <div class="cell-red" val="7" onclick="cell(7)">7</div>
            <div class="cell-red" val="8" onclick="cell(8)">8</div>
            <div class="cell-red" val="9" onclick="cell(9)">9</div>
            <div class="cell-red" val="10" onclick="cell(10)">10</div>
            <div class="cell-red" val="11" onclick="cell(11)">11</div>
            <div class="cell-red" val="12" onclick="cell(12)">12</div>
            <div class="cell-red" val="13" onclick="cell(13)">13</div>
            <div class="cell-red" val="14" onclick="cell(14)">14</div>
            <div class="cell-red" val="15" onclick="cell(15)">15</div>
            <div class="cell-red" val="16" onclick="cell(16)">16</div>
            <div class="cell-red" val="17" onclick="cell(17)">17</div>
            <div class="cell-red" val="18" onclick="cell(18)">18</div>
            <div class="cell-red" val="19" onclick="cell(19)">19</div>
            <div class="cell-red" val="20" onclick="cell(20)">20</div>
            <div class="cell-red" val="21" onclick="cell(21)">21</div>
            <div class="cell-red" val="22" onclick="cell(22)">22</div>
            <div class="cell-red" val="23" onclick="cell(23)">23</div>
            <div class="cell-red" val="24" onclick="cell(24)">24</div>
            <div class="cell-red" val="25" onclick="cell(25)">25</div>
            <div class="cell-black" val="1" onclick="cell(1)">1</div>
            <div class="cell-black" val="2" onclick="cell(2)">2</div>
            <div class="cell-black" val="3" onclick="cell(3)">3</div>
            <div class="cell-black" val="4" onclick="cell(4)">4</div>
            <div class="cell-black" val="5" onclick="cell(5)">5</div>
            <div class="cell-black" val="6" onclick="cell(6)">6</div>
            <div class="cell-black" val="7" onclick="cell(7)">7</div>
            <div class="cell-black" val="8" onclick="cell(8)">8</div>
            <div class="cell-black" val="9" onclick="cell(9)">9</div>
            <div class="cell-black" val="10" onclick="cell(10)">10</div>
            <div class="cell-black" val="11" onclick="cell(11)">11</div>
            <div class="cell-black" val="12" onclick="cell(12)">12</div>
            <div class="cell-black" val="13" onclick="cell(13)">13</div>
            <div class="cell-black" val="14" onclick="cell(14)">14</div>
            <div class="cell-black" val="15" onclick="cell(15)">15</div>
            <div class="cell-black" val="16" onclick="cell(16)">16</div>
            <div class="cell-black" val="17" onclick="cell(17)">17</div>
            <div class="cell-black" val="18" onclick="cell(18)">18</div>
            <div class="cell-black" val="19" onclick="cell(19)">19</div>
            <div class="cell-black" val="20" onclick="cell(20)">20</div>
            <div class="cell-black" val="21" onclick="cell(21)">21</div>
            <div class="cell-black" val="22" onclick="cell(22)">22</div>
            <div class="cell-black" val="23" onclick="cell(23)">23</div>
            <div class="cell-black" val="24" onclick="cell(24)">24</div>
        </div>
        <a href="/red_black_table" class="restart_button" id='Retry'>Заново</a>
    </div>
</div>
<script>
    const globalContainer = document.getElementById('Tester');
    const REFRESH_INTERVAL = 3;
    const correctSequence = [1, 24, 2, 23, 3, 22, 4, 21, 5, 20, 6, 19, 7, 18, 8, 17, 9, 16, 10, 15, 11, 14, 12, 13, 13, 12, 14, 11, 15, 10, 16, 9, 17, 8, 18, 7, 19, 6, 20, 5, 21, 4, 22, 3, 23, 2, 24, 1, 25];

    let isDuringTest = false;
    let timePassed = 0;
    let initTime = 0;
    let cursor = 0;


    function shuffle(array) {
        let currentIndex = array.length,
            temporaryValue, randomIndex;

        // While there remain elements to shuffle...
        while (0 !== currentIndex) {

            // Pick a remaining element...
            randomIndex = Math.floor(Math.random() * currentIndex);
            currentIndex -= 1;

            // And swap it with the current element.
            temporaryValue = array[currentIndex];
            array[currentIndex] = array[randomIndex];
            array[randomIndex] = temporaryValue;
        }

        return array;
    }

    function start_test() {
        isDuringTest = true;
        document.getElementById('Timer').style.display = 'flex';
        document.getElementById('Instruction').style.display = 'none';
        document.getElementById('Start_button').style.display = 'none';
        document.getElementById('bg').style.background = 'black';
        document.getElementById('Scene').style.display = 'block';
        const container = document.querySelector('.scene');
        const children = [...container.children];
        shuffle(children);
        for (const child of children) {
            container.appendChild(child);
        }
        initTime = new Date().getTime();
        let timer = setInterval(function() {

            let now = new Date().getTime();

            let distance = now - initTime;

            timePassed = distance/1000;

            document.getElementById("Timer").innerHTML = timePassed + "s";

            if (!isDuringTest) {
                clearInterval(timer);
            }

        }, REFRESH_INTERVAL);
    }



    function cell(val) {
        if (val === correctSequence[cursor]) {
            if (cursor === 48) {
                document.getElementById('Final Result').innerHTML = "Время: " + timePassed + 's';
                finish_test();
            }
            cursor++;
        } else {
            document.getElementById('Final Result').innerHTML = "Вы выбрали неверную ячейку";
            finish_test();
        }
    }

    function finish_test() {
        isDuringTest = false;
        document.getElementById('Final Result').style.display = 'block';
        document.getElementById('Timer').style.display = 'none';
        document.getElementById('Scene').style.display = 'none';
        document.getElementById('Retry').style.display = 'block';
    }

</script>
</body>
</html>